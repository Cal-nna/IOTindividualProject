<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CalWeb Scene</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body class="{{ scene }}">
<div class="scene">

<div class="container">
<div class="clouds">
    <div class="cloud one"></div>
    <div class="cloud two"></div>
</div>

<div class="mountains"></div>
<div class="ground"></div>

<div class="content">
    <div>
        <h1>{{ scene | capitalize }} Mode</h1>

{% if current_user.is_authenticated %}
<button onclick="setMode('day')">Day</button>
<button onclick="setMode('night')">Night</button>
{% else %}
<p><a href="{{ url_for('login') }}" class="login-button">
    Login to change scene
</a>
</p>
{% endif %}    </div>

    <!-- Inline helper script -->
<script>
function setMode(mode) {
    fetch("/api/visual", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ mode }),
        redirect: "manual"
    })
    .then(res => {
        if (res.status === 401 || res.status === 302) {
            window.location.href = "/login";
        }
    });
}
</script>

    <!-- PubNub -->
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.7.6.2.min.js"></script>
    <script src="{{ url_for('static', filename='js/pubnub.js') }}"></script>
</div>
</div>
</div>
</body>
</html>
